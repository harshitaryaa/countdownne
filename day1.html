<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scratch Cards</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
            background: linear-gradient(135deg, #ffebee 0%, #f8bbd0 100%);
            margin: 0;
            font-family: 'Poppins', sans-serif;
            padding: 20px;
            overflow: hidden;
        }

        h1 {
            margin-bottom: 20px;
            color: #ff4081;
            font-size: 2.5rem;
            text-align: center;
            animation: fadeIn 1s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .scratch-card-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 900px;
            animation: slideIn 1s ease-in-out;
        }

        @keyframes slideIn {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .scratch-card {
            position: relative;
            width: 250px;
            height: 250px;
            background-color: #ff6b8b;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(255, 105, 140, 0.5);
            text-align: center;
            border: 5px solid #ff4081;
            display: none;
        }

        .scratch-card:hover {
            transform: scale(1.05);
        }

        .scratch-card canvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 0;
            width: 100%;
            height: 100%;
        }

        .confetti {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 1;
        }

        .confetti div {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #ff4081;
            opacity: 0.8;
            animation: fall 3s infinite;
            border-radius: 50%;
        }

        @keyframes fall {
            0% { transform: translateY(-100px); }
            100% { transform: translateY(100vh); }
        }

        .timer {
            font-size: 2rem;
            color: #ff4081;
            margin-bottom: 20px;
        }

        .password-container {
            display: none;
            margin-top: 20px;
        }

        .password-input {
            padding: 10px;
            font-size: 1rem;
            margin-right: 10px;
        }

        .open-button {
            padding: 10px 20px;
            background-color: #ff4081;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .message {
            font-size: 1.5rem;
            color: black;
            margin-top: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <h1>Happy Birthday!</h1>
    <div class="confetti">
        <div style="left: 10%; animation-delay: 0s; background-color: #ff4081;"></div>
        <div style="left: 20%; animation-delay: 0.5s; background-color: #ffeb3b;"></div>
        <div style="left: 30%; animation-delay: 1s; background-color: #4caf50;"></div>
        <div style="left: 40%; animation-delay: 1.5s; background-color: #2196f3;"></div>
        <div style="left: 50%; animation-delay: 2s; background-color: #ff4081;"></div>
        <div style="left: 60%; animation-delay: 0.5s; background-color: #ffeb3b;"></div>
        <div style="left: 70%; animation-delay: 1s; background-color: #4caf50;"></div>
        <div style="left: 80%; animation-delay: 1.5s; background-color: #2196f3;"></div>
        <div style="left: 90%; animation-delay: 2s; background-color: #ff4081;"></div>
    </div>

    <div class="timer" id="timer">00:30</div>
    <button class="open-button" id="openEarlyBtn">Open Early with Password</button>

    <div class="password-container" id="passwordContainer">
        <input type="password" class="password-input" id="passwordInput" placeholder="Enter Password">
        <button class="open-button" id="submitPasswordBtn">Submit</button>
    </div>

    <div class="scratch-card-container">
        <div class="scratch-card" data-message="Happy Birthday, Ankita! 🎉">
            <canvas class="scratchCanvas" width="250" height="250"></canvas>
        </div>
        <div class="scratch-card" data-message="Enjoy Your Special Day! 🎈">
            <canvas class="scratchCanvas" width="250" height="250"></canvas>
        </div>
        <div class="scratch-card" data-message="Wishing You All the Best! 🎁">
            <canvas class="scratchCanvas" width="250" height="250"></canvas>
        </div>
    </div>

    <div class="message" id="messageDisplay"></div>

    <script>
        const scratchCards = document.querySelectorAll('.scratch-card');
        const timerDisplay = document.getElementById('timer');
        const openEarlyBtn = document.getElementById('openEarlyBtn');
        const passwordContainer = document.getElementById('passwordContainer');
        const passwordInput = document.getElementById('passwordInput');
        const submitPasswordBtn = document.getElementById('submitPasswordBtn');
        const password = "04092002";
        const messageDisplay = document.getElementById('messageDisplay');
        let countdown;

        // New logic to sync timer with localStorage
        const targetTimestamp = localStorage.getItem('countdownTarget');
        if (targetTimestamp) {
            const targetDate = new Date(parseInt(targetTimestamp));
            const now = new Date();
            const remainingSeconds = Math.floor((targetDate.getTime() - now.getTime()) / 1000);

            if (remainingSeconds > 0) {
                startTimer(remainingSeconds);
            } else {
                revealScratchCards();
            }
        } else {
            revealScratchCards();
        }

        function startTimer(duration) {
            let timer = duration, minutes, seconds;
            countdown = setInterval(function () {
                minutes = parseInt(timer / 60, 10);
                seconds = parseInt(timer % 60, 10);

                seconds = seconds < 10 ? "0" + seconds : seconds;
                minutes = minutes < 10 ? "0" + minutes : minutes;

                timerDisplay.textContent = minutes + ":" + seconds;

                if (--timer < 0) {
                    clearInterval(countdown);
                    revealScratchCards();
                }
            }, 1000);
        }

        function revealScratchCards() {
            scratchCards.forEach(card => {
                card.style.display = 'block';
            });
            timerDisplay.style.display = 'none';
            openEarlyBtn.style.display = 'none';
        }

        openEarlyBtn.addEventListener('click', () => {
            passwordContainer.style.display = 'block';
        });

        submitPasswordBtn.addEventListener('click', () => {
            if (passwordInput.value === password) {
                revealScratchCards();
                passwordContainer.style.display = 'none';
            } else {
                alert('Incorrect password. Please try again.');
            }
        });

        scratchCards.forEach(card => {
            const canvas = card.querySelector('.scratchCanvas');
            const ctx = canvas.getContext('2d');
            const message = card.getAttribute('data-message');

            const patternCanvas = document.createElement('canvas');
            const patternCtx = patternCanvas.getContext('2d');
            patternCanvas.width = 10;
            patternCanvas.height = 10;

            patternCtx.strokeStyle = '#ff4081';
            patternCtx.lineWidth = 2;
            patternCtx.beginPath();
            patternCtx.moveTo(0, 10);
            patternCtx.lineTo(10, 0);
            patternCtx.moveTo(10, 10);
            patternCtx.lineTo(0, 0);
            patternCtx.stroke();

            const pattern = ctx.createPattern(patternCanvas, 'repeat');
            ctx.fillStyle = pattern;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            let isDrawing = false;

            canvas.addEventListener('mousedown', startScratch);
            canvas.addEventListener('mouseup', endScratch);
            canvas.addEventListener('mousemove', scratch);
            canvas.addEventListener('touchstart', startScratch);
            canvas.addEventListener('touchend', endScratch);
            canvas.addEventListener('touchmove', scratch);

            function startScratch(e) {
                isDrawing = true;
                scratch(e);
            }

            function endScratch() {
                isDrawing = false;
                ctx.beginPath();
            }

            function scratch(e) {
                if (!isDrawing) return;
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - rect.left;
                const y = (e.clientY || e.touches[0].clientY) - rect.top;

                ctx.globalCompositeOperation = 'destination-out';
                ctx.beginPath();
                ctx.arc(x, y, 20, 0, Math.PI * 2, false);
                ctx.fill();
                ctx.globalCompositeOperation = 'source-over';

                const scratchedArea = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const scratchedPixels = scratchedArea.data.filter(value => value === 0).length;

                if (scratchedPixels > 10000) {
                    revealMessage(message);
                }
            }

            function revealMessage(message) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'black';
                ctx.font = '20px Poppins';
                ctx.textAlign = 'center';
                ctx.fillText(message, canvas.width / 2, canvas.height / 2);
                messageDisplay.textContent = message;
                messageDisplay.style.display = 'block';
            }
        });
    </script>
</body>
</html>
